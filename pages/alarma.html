<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="../rana.svg" type="image/x-icon">
    <meta name="copyright" content="Manuel Casimiro Carrasco">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urukais Klick - Alarma</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">
</head>
<body>
    <nav class="menu">
        <div class="menu-icon">
            <i class="fas fa-bars"></i>
        </div>
        <ul class="menu-items">
            <li><a href="../index.html"><i class="fas fa-home"></i> <span data-translate="home">Inicio</span></a></li>
            <li class="active"><a href="/sounds.html"><i class="fas fa-home"></i> Videos</span></a></li>
            <li><a href="cronometro.html"><i class="fas fa-stopwatch"></i> <span data-translate="stopwatch">Cron√≥metro</span></a></li>
            <li class="active"><a href="alarma.html"><i class="fas fa-clock"></i> <span data-translate="alarm">Alarma</span></a></li>
            <li class="submenu">
                <a href="#"><i class="fas fa-palette"></i> <span data-translate="themes">Temas</span> <i class="fas fa-chevron-down"></i></a>
                <ul class="submenu-items">
                    <li><a href="#" data-theme="green"><i class="fas fa-circle"></i> <span data-translate="green">Verde</span></a></li>
                    <li><a href="#" data-theme="blue"><i class="fas fa-circle"></i> <span data-translate="blue">Azul</span></a></li>
                    <li><a href="#" data-theme="purple"><i class="fas fa-circle"></i> <span data-translate="purple">P√∫rpura</span></a></li>
                </ul>
            </li>
            <li class="submenu">
                <a href="#"><i class="fas fa-cog"></i> <span data-translate="settings">Configuraci√≥n</span> <i class="fas fa-chevron-down"></i></a>
                <ul class="submenu-items">
                    <li><a href="sounds.html"><i class="fas fa-volume-up"></i> <span data-translate="sounds">Sonidos</span></a></li>
                    <li class="submenu">
                        <a href="#"><i class="fas fa-language"></i> <span data-translate="language">Idioma</span> <i class="fas fa-chevron-down"></i></a>
                        <ul class="submenu-items language-menu">
                            <li><a href="#" onclick="setLanguage('es')"><span class="flag-icon flag-icon-es"></span> Espa√±ol</a></li>
                            <li><a href="#" onclick="setLanguage('en')"><span class="flag-icon flag-icon-gb"></span> English</a></li>
                            <li><a href="#" onclick="setLanguage('fr')"><span class="flag-icon flag-icon-fr"></span> Fran√ßais</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li><a href="/pages/a-cerca-de.html"><i class="fas fa-info-circle"></i> <span data-translate="about">Acerca de</span></a></li>
        </ul>
    </nav>
    <div class="menu-overlay"></div>

    <div class="contenedor">
        <h1>üê∏ Alarma üê∏</h1>
        
        <div class="alarma-container">
            <div class="alarma-form">
                <div class="form-group">
                    <label for="tipoAlarma">Tipo de Alarma:</label>
                    <select id="tipoAlarma" class="tiempo-input">
                        <option value="una-vez">Una vez</option>
                        <option value="diaria">Diaria</option>
                        <option value="dias-especificos">D√≠as espec√≠ficos</option>
                        <option value="calendario">Desde Calendario</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Hora:</label>
                    <div class="tiempo-alarma">
                        <input type="number" id="horas" class="tiempo-input" min="0" max="23" value="00">
                        <span class="tiempo-separador">:</span>
                        <input type="number" id="minutos" class="tiempo-input" min="0" max="59" value="00">
                    </div>
                </div>

                <div id="diasSemana" class="dias-semana" style="display: none;">
                    <label>D√≠as de la semana:</label>
                    <div class="dias-grid">
                        <label class="dia-checkbox"><input type="checkbox" name="dias" value="0"> Dom</label>
                        <label class="dia-checkbox"><input type="checkbox" name="dias" value="1"> Lun</label>
                        <label class="dia-checkbox"><input type="checkbox" name="dias" value="2"> Mar</label>
                        <label class="dia-checkbox"><input type="checkbox" name="dias" value="3"> Mi√©</label>
                        <label class="dia-checkbox"><input type="checkbox" name="dias" value="4"> Jue</label>
                        <label class="dia-checkbox"><input type="checkbox" name="dias" value="5"> Vie</label>
                        <label class="dia-checkbox"><input type="checkbox" name="dias" value="6"> S√°b</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="sonidoAlarma">Video de alarma:</label>
                    <div class="video-selector">
                        <select id="sonidoAlarma" class="tiempo-input">
                            <option value="">Selecciona un video</option>
                            <option value="Cyberpunk POLICE 2250   AI Multiverse Short Film.mp4">Cyberpunk Police</option>
                            <option value="Black Sabbath ‚Äì Headless Cross (Official HD Video).mp4">Black Sabbath</option>
                            <option value="Motionless In White - Meltdown [Official Audio + Lyrics].mp4">Motionless In White - Meltdown </option>
                            <option value="Disturbed - Down With The Sickness (Violet Orlandi ft Ai Mori COVER).mp4">isturbed - Down With The Sickness </option>
                            <option value="METALWINGS - Crying of the Sun [OFFICIAL VIDEO].mp4">METALWINGS  </option>
                            <option value="RAMMSTEIN ROSA PASTEL   PARODIA.mp4">RAMMSTEIN ROSA PASTEL </option>
                            <option value="SKYFALL - Electric Ladies.mp4">SKYFALL - Electric Ladies </option>
                            <option value="Motionless In White - Werewolf [Official Video].webm">Motionless In White - Meltdown </option>
                            <option value="March of Titans - Epic Rock Music   AI Short Animated Cinematic.mp4">/March of Titans - Epic Rock Music </option>
                            <option value="SKYFALL - Electric Ladies.mp4">SKYFALL - Electric Ladies </option>
                        </select>
                        <div id="videoPreview" class="video-preview" style="display: none;">
                            <video id="previewVideo" controls>
                                <source src="" type="video/mp4">
                                Tu navegador no soporta el elemento de video.
                            </video>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="descripcion">Descripci√≥n:</label>
                    <input type="text" id="descripcion" placeholder="Descripci√≥n (opcional)" class="tiempo-input">
                </div>

                <div id="opcionesCalendario" class="opciones-extra" style="display: none;">
                    <div class="form-group">
                        <label>Integrar con:</label>
                        <div class="integraciones">
                            <button class="btn-integracion" onclick="sincronizarGoogleCalendar()">
                                <i class="fab fa-google"></i> Google Calendar
                            </button>
                            <button class="btn-integracion" onclick="sincronizarOutlook()">
                                <i class="fab fa-microsoft"></i> Outlook
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Opciones adicionales:</label>
                    <div class="opciones-adicionales">
                        <label class="opcion-checkbox">
                            <input type="checkbox" id="noMolestar">
                            <span>Modo "No molestar" autom√°tico</span>
                        </label>
                        <label class="opcion-checkbox">
                            <input type="checkbox" id="compartirAlarma">
                            <span>Compartir alarma</span>
                        </label>
                        <label class="opcion-checkbox">
                            <input type="checkbox" id="sincronizarFitness">
                            <span></span>
                        </label>
                    </div>
                </div>

                <div id="opcionesCompartir" class="opciones-extra" style="display: none;">
                    <div class="form-group">
                        <label>Compartir con:</label>
                        <div class="integraciones">
                            <button class="btn-integracion" onclick="compartirWhatsApp()">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                            <button class="btn-integracion" onclick="compartirTelegram()">
                                <i class="fab fa-telegram"></i> Telegram
                            </button>
                            <button class="btn-integracion" onclick="compartirEmail()">
                                <i class="fas fa-envelope"></i> Email
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Opciones de bienestar:</label>
                    <div class="opciones-bienestar">
                        <label class="opcion-checkbox">
                            <input type="checkbox" id="recordatorioAgua">
                            <span>Recordatorios para beber agua</span>
                        </label>
                        <label class="opcion-checkbox">
                            <input type="checkbox" id="ejerciciosMatutinos">
                            <span>Ejercicios matutinos sugeridos</span>
                        </label>
                        <label class="opcion-checkbox">
                            <input type="checkbox" id="meditacionGuiada">
                            <span>Meditaci√≥n guiada para despertar</span>
                        </label>
                        <label class="opcion-checkbox">
                            <input type="checkbox" id="seguimientoSueno">
                            <span>Seguimiento del ciclo de sue√±o</span>
                        </label>
                    </div>
                </div>

                <div id="opcionesBienestar" class="opciones-extra" style="display: none;">
                    <div class="form-group">
                        <label>Configuraci√≥n de bienestar:</label>
                        <div class="config-bienestar">
                            <div class="config-item">
                                <label>Frecuencia de recordatorios de agua:</label>
                                <select id="frecuenciaAgua" class="tiempo-input">
                                    <option value="30">Cada 30 minutos</option>
                                    <option value="60">Cada hora</option>
                                    <option value="90">Cada 1.5 horas</option>
                                    <option value="120">Cada 2 horas</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <label>Tipo de ejercicios matutinos:</label>
                                <select id="tipoEjercicios" class="tiempo-input">
                                    <option value="estiramientos">Estiramientos suaves</option>
                                    <option value="yoga">Yoga b√°sico</option>
                                    <option value="cardio">Cardio ligero</option>
                                    <option value="fuerza">Ejercicios de fuerza</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <label>Duraci√≥n de la meditaci√≥n:</label>
                                <select id="duracionMeditacion" class="tiempo-input">
                                    <option value="5">5 minutos</option>
                                    <option value="10">10 minutos</option>
                                    <option value="15">15 minutos</option>
                                    <option value="20">20 minutos</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="opcionesSueno" class="opciones-extra" style="display: none;">
                    <div class="form-group">
                        <label>Configuraci√≥n del sue√±o:</label>
                        <div class="config-sueno">
                            <div class="config-item">
                                <label>Horas de sue√±o objetivo:</label>
                                <select id="horasSueno" class="tiempo-input">
                                    <option value="7">7 horas</option>
                                    <option value="8" selected>8 horas</option>
                                    <option value="9">9 horas</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <label>Hora de despertar:</label>
                                <input type="time" id="horaDespertar" class="tiempo-input">
                            </div>
                            <div class="config-item">
                                <label>Registrar calidad del sue√±o:</label>
                                <div class="calidad-sueno">
                                    <button class="btn-calidad" data-calidad="excelente">ÔøΩÔøΩ Excelente</button>
                                    <button class="btn-calidad" data-calidad="bueno">üòå Bueno</button>
                                    <button class="btn-calidad" data-calidad="regular">üòê Regular</button>
                                    <button class="btn-calidad" data-calidad="malo">üò´ Malo</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="resumen-sueno">
                        <h3>Resumen de sue√±o</h3>
                        <div id="resumenSueno" class="resumen-content">
                            <div class="resumen-item">
                                <i class="fas fa-moon"></i>
                                <span>Hora recomendada para dormir: </span>
                                <strong id="horaDormirRecomendada">--:--</strong>
                            </div>
                            <div class="resumen-item">
                                <i class="fas fa-sun"></i>
                                <span>Hora de despertar: </span>
                                <strong id="horaDespertarMostrada">--:--</strong>
                            </div>
                            <div class="resumen-item">
                                <i class="fas fa-chart-line"></i>
                                <span>Calidad promedio del sue√±o: </span>
                                <strong id="calidadPromedio">--</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="establecerAlarma" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Establecer Alarma
                </button>
            </div>

            <div class="alarmas-activas">
                <h2><i class="fas fa-clock"></i> Alarmas Programadas</h2>
                <div id="listaAlarmas"></div>
            </div>
        </div>

        <div id="videoContainer" class="video-container" style="display: none;">
            <video id="video" controls>
                <source src="../videos/Cyberpunk POLICE 2250   AI Multiverse Short Film.mp4" type="video/mp4">
                Tu navegador no soporta el elemento de video.
            </video>
            <button id="detenerAlarma" class="btn btn-detener">
                <i class="fas fa-stop"></i> Detener Alarma
            </button>
        </div>
    </div>

    <div class="footer-bottom">
        <p>¬© 2025 Urukais Klick. Todos los derechos reservados.</p>
        <p>Desarrollado con <i class="fas fa-heart"></i> <a href="https://silly-boba-dc057e.netlify.app/" target="blank">por Manuel Casimiro Carrasco</a></p>
        <div class="legal-links">
            <a href="../legal/terminos.html">T√©rminos y Condiciones</a> |
            <a href="../legal/privacidad.html">Pol√≠tica de Privacidad</a> |
            <a href="../legal/cookies.html">Pol√≠tica de Cookies</a>
        </div>
    </div>

    <script src="../js/menu.js"></script>
    <script src="../js/themes.js"></script>
    <script src="../js/language.js"></script>
    <script src="../js/sounds.js"></script>
    <script src="../js/service-worker.js"></script>

    <script>
        // Variables globales
        let alarmas = [];
        let registroAlarmas = [];
        let alarmaActual = null;
        
        // Elementos del DOM
        const btnEstablecerAlarma = document.getElementById('establecerAlarma');
        const btnDetener = document.getElementById('detenerAlarma');
        const videoContainer = document.getElementById('videoContainer');
        const video = document.getElementById('video');
        const listaAlarmas = document.getElementById('listaAlarmas');

        // Cargar alarmas guardadas al inicio
        document.addEventListener('DOMContentLoaded', () => {
            cargarAlarmas();
            cargarVideos();
            actualizarListaAlarmas();
            setInterval(verificarAlarmas, 1000); // Verificar cada segundo
        });

        // Funci√≥n para cargar alarmas
        function cargarAlarmas() {
            try {
                const alarmasGuardadas = localStorage.getItem('alarmas');
                if (alarmasGuardadas) {
                    alarmas = JSON.parse(alarmasGuardadas);
                }
            } catch (error) {
                console.error('Error al cargar alarmas:', error);
                alarmas = [];
            }
        }

        // Funci√≥n para cargar los videos en el selector
        function cargarVideos() {
            const select = document.getElementById('sonidoAlarma');
            const videoPreview = document.getElementById('videoPreview');
            const previewVideo = document.getElementById('previewVideo');

            select.addEventListener('change', function() {
                if (this.value) {
                    previewVideo.src = `../videos/${this.value}`;
                    videoPreview.style.display = 'block';
                    previewVideo.load();
                    previewVideo.play().catch(error => {
                        console.error('Error al reproducir la previsualizaci√≥n:', error);
                    });
                } else {
                    videoPreview.style.display = 'none';
                    previewVideo.pause();
                    previewVideo.src = '';
                }
            });
        }

        // Mostrar/ocultar selector de d√≠as
        document.getElementById('tipoAlarma').addEventListener('change', function(e) {
            const diasSemana = document.getElementById('diasSemana');
            diasSemana.style.display = e.target.value === 'dias-especificos' ? 'block' : 'none';
        });

        // Mostrar/ocultar opciones de calendario
        document.getElementById('tipoAlarma').addEventListener('change', function(e) {
            const opcionesCalendario = document.getElementById('opcionesCalendario');
            opcionesCalendario.style.display = e.target.value === 'calendario' ? 'block' : 'none';
        });

        // Mostrar/ocultar opciones de compartir
        document.getElementById('compartirAlarma').addEventListener('change', function(e) {
            const opcionesCompartir = document.getElementById('opcionesCompartir');
            opcionesCompartir.style.display = e.target.checked ? 'block' : 'none';
        });

        // Mostrar/ocultar opciones de sue√±o
        document.getElementById('seguimientoSueno').addEventListener('change', function(e) {
            const opcionesSueno = document.getElementById('opcionesSueno');
            opcionesSueno.style.display = e.target.checked ? 'block' : 'none';
            if (e.target.checked) {
                actualizarResumenSueno();
            }
        });

        // Mostrar/ocultar opciones de bienestar
        document.querySelectorAll('.opciones-bienestar input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const opcionesBienestar = document.getElementById('opcionesBienestar');
                const hayOpcionesSeleccionadas = Array.from(document.querySelectorAll('.opciones-bienestar input[type="checkbox"]'))
                    .some(cb => cb.checked);
                opcionesBienestar.style.display = hayOpcionesSeleccionadas ? 'block' : 'none';
            });
        });

        // Establecer nueva alarma
        btnEstablecerAlarma.addEventListener('click', () => {
            try {
                const horas = parseInt(document.getElementById('horas').value) || 0;
                const minutos = parseInt(document.getElementById('minutos').value) || 0;
                const tipoAlarma = document.getElementById('tipoAlarma').value;
                const descripcion = document.getElementById('descripcion').value.trim();
                const sonidoSeleccionado = document.getElementById('sonidoAlarma').value;

                // Validar que se haya seleccionado un video
                if (!sonidoSeleccionado) {
                    alert('Por favor, selecciona un video para la alarma');
                    return;
                }

                // Validaciones
                if (horas < 0 || horas > 23 || minutos < 0 || minutos > 59) {
                    alert('Por favor, ingresa una hora v√°lida');
                    return;
                }

                // Validar hora futura para alarmas √∫nicas
                if (tipoAlarma === 'una-vez') {
                    const ahora = new Date();
                    const horaAlarma = new Date();
                    horaAlarma.setHours(horas, minutos, 0, 0);
                    
                    if (horaAlarma <= ahora) {
                        alert('No puedes programar una alarma para una hora pasada');
                        return;
                    }
                }

                // Obtener d√≠as seleccionados
                let diasSeleccionados = [];
                if (tipoAlarma === 'dias-especificos') {
                    diasSeleccionados = Array.from(document.querySelectorAll('#diasSemana input:checked'))
                        .map(input => parseInt(input.value));
                    
                    if (diasSeleccionados.length === 0) {
                        alert('Por favor, selecciona al menos un d√≠a de la semana');
                        return;
                    }
                }

                // Crear nueva alarma
                const nuevaAlarma = {
                    id: Date.now(),
                    horas,
                    minutos,
                    tipoAlarma,
                    descripcion,
                    diasSeleccionados,
                    sonidoSeleccionado,
                    activa: true
                };

                // Verificar duplicados
                const alarmaExiste = alarmas.some(alarma => 
                    alarma.horas === horas && 
                    alarma.minutos === minutos && 
                    alarma.tipoAlarma === tipoAlarma &&
                    JSON.stringify(alarma.diasSeleccionados) === JSON.stringify(diasSeleccionados)
                );

                if (alarmaExiste) {
                    alert('Esta alarma ya est√° programada');
                    return;
                }

                // Guardar alarma
                alarmas.push(nuevaAlarma);
                localStorage.setItem('alarmas', JSON.stringify(alarmas));
                actualizarListaAlarmas();

                // Mensaje de confirmaci√≥n
                let mensaje = `‚úÖ Alarma programada para las ${formatearTiempo(horas)}:${formatearTiempo(minutos)}`;
                if (tipoAlarma === 'diaria') {
                    mensaje += ' todos los d√≠as';
                } else if (tipoAlarma === 'dias-especificos') {
                    const diasTexto = diasSeleccionados.map(d => ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'][d]).join(', ');
                    mensaje += ` los d√≠as: ${diasTexto}`;
                }
                alert(mensaje);

                // Limpiar formulario
                document.getElementById('horas').value = '00';
                document.getElementById('minutos').value = '00';
                document.getElementById('descripcion').value = '';
                document.querySelectorAll('#diasSemana input').forEach(input => input.checked = false);

            } catch (error) {
                console.error('Error al establecer la alarma:', error);
                alert('Error al establecer la alarma. Por favor, intenta de nuevo.');
            }
        });

        // Funci√≥n para verificar alarmas
        function verificarAlarmas() {
            const ahora = new Date();
            const horaActual = ahora.getHours();
            const minutosActual = ahora.getMinutes();
            const diaActual = ahora.getDay();

            alarmas.forEach((alarma, index) => {
                if (alarma.activa) {
                    let debeSonar = false;

                    if (alarma.tipoAlarma === 'una-vez') {
                        debeSonar = alarma.horas === horaActual && alarma.minutos === minutosActual;
                    } else if (alarma.tipoAlarma === 'diaria') {
                        debeSonar = alarma.horas === horaActual && alarma.minutos === minutosActual;
                    } else if (alarma.tipoAlarma === 'dias-especificos') {
                        debeSonar = alarma.diasSeleccionados.includes(diaActual) && 
                                   alarma.horas === horaActual && 
                                   alarma.minutos === minutosActual;
                    }

                    if (debeSonar) {
                        reproducirAlarma(alarma);
                        
                        if (alarma.tipoAlarma === 'una-vez') {
                            alarmas.splice(index, 1);
                            localStorage.setItem('alarmas', JSON.stringify(alarmas));
                            actualizarListaAlarmas();
                        }
                    }
                }
            });
        }

        // Funci√≥n para reproducir alarma
        function reproducirAlarma(alarma) {
            try {
                alarmaActual = alarma;
                const videoPath = `../videos/${alarma.sonidoSeleccionado}`;
                
                video.src = videoPath;
                video.load();
                videoContainer.style.display = 'block';
                
                video.play().then(() => {
                    console.log('Video reproduci√©ndose correctamente');
                }).catch(error => {
                    console.error('Error al reproducir el video:', error);
                    alert('Error al reproducir el video. Por favor, verifica que el archivo existe.');
                    videoContainer.style.display = 'none';
                });
                
                if ('Notification' in window) {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification('¬°Alarma!', {
                                body: alarma.descripcion || 'Es hora de tu alarma',
                                icon: '../rana.svg'
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('Error en reproducirAlarma:', error);
                alert('Error al reproducir la alarma. Por favor, intenta de nuevo.');
            }
        }

        // Detener alarma
        btnDetener.addEventListener('click', () => {
            try {
                video.pause();
                video.currentTime = 0;
                videoContainer.style.display = 'none';
                alarmaActual = null;
            } catch (error) {
                console.error('Error al detener la alarma:', error);
            }
        });

        // Funci√≥n para actualizar lista de alarmas
        function actualizarListaAlarmas() {
            if (alarmas.length === 0) {
                listaAlarmas.innerHTML = `
                    <div class="alarma-item">
                        <div class="alarma-info">
                            <div class="alarma-tiempo">
                                <i class="fas fa-info-circle"></i> No hay alarmas programadas
                            </div>
                            <div class="alarma-detalle">
                                Haz clic en "Establecer Alarma" para crear una nueva
                            </div>
                        </div>
                    </div>`;
                return;
            }
            
            listaAlarmas.innerHTML = alarmas.map((alarma, index) => {
                let repeticionTexto = '';
                if (alarma.tipoAlarma === 'diaria') {
                    repeticionTexto = 'Todos los d√≠as';
                } else if (alarma.tipoAlarma === 'dias-especificos') {
                    const dias = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
                    repeticionTexto = alarma.diasSeleccionados.map(d => dias[d]).join(', ');
                }
                
                return `
                    <div class="alarma-item">
                        <div class="alarma-info">
                            <div class="alarma-tiempo">
                                <i class="fas fa-clock"></i> 
                                ${formatearTiempo(alarma.horas)}:${formatearTiempo(alarma.minutos)}
                            </div>
                            <div class="alarma-detalle">
                                ${repeticionTexto}
                                ${alarma.descripcion ? `<br><i class="fas fa-info-circle"></i> ${alarma.descripcion}` : ''}
                                <br><i class="fas fa-video"></i> ${alarma.sonidoSeleccionado}
                            </div>
                        </div>
                        <button class="btn-eliminar" onclick="eliminarAlarma(${index})">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>`;
            }).join('');
        }

        // Funci√≥n para eliminar alarma
        function eliminarAlarma(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta alarma?')) {
                alarmas.splice(index, 1);
                localStorage.setItem('alarmas', JSON.stringify(alarmas));
                actualizarListaAlarmas();
            }
        }

        // Funci√≥n para formatear tiempo
        function formatearTiempo(tiempo) {
            return tiempo.toString().padStart(2, '0');
        }

        // Funci√≥n para sincronizar con Google Calendar
        function sincronizarGoogleCalendar() {
            // Aqu√≠ ir√≠a la l√≥gica de autenticaci√≥n con Google Calendar API
            alert('Funcionalidad de sincronizaci√≥n con Google Calendar en desarrollo');
        }

        // Funci√≥n para sincronizar con Outlook
        function sincronizarOutlook() {
            // Aqu√≠ ir√≠a la l√≥gica de autenticaci√≥n con Outlook API
            alert('Funcionalidad de sincronizaci√≥n con Outlook en desarrollo');
        }

        // Funci√≥n para compartir por WhatsApp
        function compartirWhatsApp() {
            const alarma = obtenerAlarmaActual();
            const mensaje = `¬°Te comparto mi alarma! Se activar√° a las ${alarma.horas}:${alarma.minutos}`;
            const url = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
            window.open(url, '_blank');
        }

        // Funci√≥n para compartir por Telegram
        function compartirTelegram() {
            const alarma = obtenerAlarmaActual();
            const mensaje = `¬°Te comparto mi alarma! Se activar√° a las ${alarma.horas}:${alarma.minutos}`;
            const url = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(mensaje)}`;
            window.open(url, '_blank');
        }

        // Funci√≥n para compartir por Email
        function compartirEmail() {
            const alarma = obtenerAlarmaActual();
            const asunto = 'Te comparto mi alarma';
            const mensaje = `¬°Hola! Te comparto mi alarma que se activar√° a las ${alarma.horas}:${alarma.minutos}`;
            const url = `mailto:?subject=${encodeURIComponent(asunto)}&body=${encodeURIComponent(mensaje)}`;
            window.open(url, '_blank');
        }

        // Funci√≥n para obtener la alarma actual
        function obtenerAlarmaActual() {
            return {
                horas: document.getElementById('horas').value,
                minutos: document.getElementById('minutos').value,
                tipo: document.getElementById('tipoAlarma').value,
                descripcion: document.getElementById('descripcion').value
            };
        }

        // Funci√≥n para activar modo "No molestar"
        function activarNoMolestar() {
            if (document.getElementById('noMolestar').checked) {
                // Aqu√≠ ir√≠a la l√≥gica para activar el modo "No molestar"
                if ('permissions' in navigator) {
                    navigator.permissions.query({ name: 'notifications' })
                        .then(permission => {
                            if (permission.state === 'granted') {
                                // Activar modo "No molestar"
                                console.log('Modo "No molestar" activado');
                            }
                        });
                }
            }
        }

        // Funci√≥n para sincronizar con apps de fitness
        function sincronizarFitness() {
            if (document.getElementById('sincronizarFitness').checked) {
                // Aqu√≠ ir√≠a la l√≥gica para sincronizar con apps de fitness
                alert('Funcionalidad de sincronizaci√≥n con apps de fitness en desarrollo');
            }
        }

        // Agregar event listeners para las nuevas funcionalidades
        document.getElementById('noMolestar').addEventListener('change', activarNoMolestar);
        document.getElementById('sincronizarFitness').addEventListener('change', sincronizarFitness);

        // Funci√≥n para iniciar recordatorios de agua
        function iniciarRecordatoriosAgua() {
            if (document.getElementById('recordatorioAgua').checked) {
                const frecuencia = parseInt(document.getElementById('frecuenciaAgua').value) * 60 * 1000; // Convertir a milisegundos
                setInterval(() => {
                    if ('Notification' in window) {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                new Notification('¬°Hora de hidratarse! üíß', {
                                    body: 'Recuerda beber un vaso de agua',
                                    icon: '../rana.svg'
                                });
                            }
                        });
                    }
                }, frecuencia);
            }
        }

        // Funci√≥n para mostrar ejercicios matutinos
        function mostrarEjerciciosMatutinos() {
            if (document.getElementById('ejerciciosMatutinos').checked) {
                const tipo = document.getElementById('tipoEjercicios').value;
                const ejercicios = {
                    estiramientos: [
                        'Estiramiento de cuello: 30 segundos cada lado',
                        'Rotaci√≥n de hombros: 10 repeticiones',
                        'Estiramiento de espalda: 30 segundos',
                        'Estiramiento de piernas: 30 segundos cada pierna'
                    ],
                    yoga: [
                        'Postura del gato-vaca: 5 respiraciones',
                        'Postura del ni√±o: 30 segundos',
                        'Postura de la monta√±a: 30 segundos',
                        'Saludo al sol: 3 repeticiones'
                    ],
                    cardio: [
                        'Jumping jacks: 30 segundos',
                        'Sentadillas: 15 repeticiones',
                        'Mountain climbers: 30 segundos',
                        'Burpees: 10 repeticiones'
                    ],
                    fuerza: [
                        'Flexiones: 10 repeticiones',
                        'Plancha: 30 segundos',
                        'Sentadillas con peso: 15 repeticiones',
                        'Zancadas: 10 cada pierna'
                    ]
                };

                const rutina = ejercicios[tipo];
                if (rutina) {
                    alert('Rutina de ejercicios sugerida:\n\n' + rutina.join('\n'));
                }
            }
        }

        // Funci√≥n para iniciar meditaci√≥n guiada
        function iniciarMeditacionGuiada() {
            if (document.getElementById('meditacionGuiada').checked) {
                const duracion = parseInt(document.getElementById('duracionMeditacion').value);
                alert(`Iniciando meditaci√≥n guiada de ${duracion} minutos...\n\n1. Encuentra una posici√≥n c√≥moda\n2. Cierra los ojos\n3. Respira profundamente\n4. Sigue las instrucciones de voz`);
            }
        }

        // Funci√≥n para iniciar seguimiento del sue√±o
        function iniciarSeguimientoSueno() {
            if (document.getElementById('seguimientoSueno').checked) {
                const horaActual = new Date();
                const horaDormir = new Date(horaActual);
                horaDormir.setHours(horaActual.getHours() - 8); // Asumimos 8 horas de sue√±o

                alert(`Seguimiento de sue√±o iniciado:\n\nHora de dormir recomendada: ${horaDormir.getHours()}:${horaDormir.getMinutes()}\nHora de despertar: ${horaActual.getHours()}:${horaActual.getMinutes()}`);
            }
        }

        // Agregar event listeners para las nuevas funcionalidades
        document.getElementById('recordatorioAgua').addEventListener('change', iniciarRecordatoriosAgua);
        document.getElementById('ejerciciosMatutinos').addEventListener('change', mostrarEjerciciosMatutinos);
        document.getElementById('meditacionGuiada').addEventListener('change', iniciarMeditacionGuiada);
        document.getElementById('seguimientoSueno').addEventListener('change', iniciarSeguimientoSueno);

        // Calcular hora recomendada para dormir
        function calcularHoraDormir() {
            const horasSueno = parseInt(document.getElementById('horasSueno').value);
            const horaDespertar = document.getElementById('horaDespertar').value;
            
            if (!horaDespertar) return;
            
            const [horas, minutos] = horaDespertar.split(':').map(Number);
            const fechaDespertar = new Date();
            fechaDespertar.setHours(horas, minutos);
            
            const fechaDormir = new Date(fechaDespertar);
            fechaDormir.setHours(fechaDespertar.getHours() - horasSueno);
            
            return fechaDormir;
        }

        // Actualizar resumen de sue√±o
        function actualizarResumenSueno() {
            const horaDormir = calcularHoraDormir();
            const horaDespertar = document.getElementById('horaDespertar').value;
            
            if (horaDormir) {
                document.getElementById('horaDormirRecomendada').textContent = 
                    `${horaDormir.getHours().toString().padStart(2, '0')}:${horaDormir.getMinutes().toString().padStart(2, '0')}`;
            }
            
            if (horaDespertar) {
                document.getElementById('horaDespertarMostrada').textContent = horaDespertar;
            }
            
            // Calcular calidad promedio
            const registros = JSON.parse(localStorage.getItem('registrosSueno')) || [];
            if (registros.length > 0) {
                const calidades = {
                    'excelente': 4,
                    'bueno': 3,
                    'regular': 2,
                    'malo': 1
                };
                const promedio = registros.reduce((acc, reg) => acc + calidades[reg.calidad], 0) / registros.length;
                const calidadTexto = Object.keys(calidades).find(key => calidades[key] === Math.round(promedio));
                document.getElementById('calidadPromedio').textContent = calidadTexto.charAt(0).toUpperCase() + calidadTexto.slice(1);
            }
        }

        // Registrar calidad del sue√±o
        document.querySelectorAll('.btn-calidad').forEach(btn => {
            btn.addEventListener('click', function() {
                const calidad = this.dataset.calidad;
                const fecha = new Date();
                
                // Guardar registro
                const registros = JSON.parse(localStorage.getItem('registrosSueno')) || [];
                registros.push({
                    fecha: fecha.toISOString(),
                    calidad: calidad
                });
                localStorage.setItem('registrosSueno', JSON.stringify(registros));
                
                // Actualizar UI
                document.querySelectorAll('.btn-calidad').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Actualizar resumen
                actualizarResumenSueno();
            });
        });

        // Event listeners para actualizar resumen
        document.getElementById('horasSueno').addEventListener('change', actualizarResumenSueno);
        document.getElementById('horaDespertar').addEventListener('change', actualizarResumenSueno);

        // Agregar estilos CSS para las alarmas
        const style = document.createElement('style');
        style.textContent = `
            .alarma-container {
                display: grid;
                grid-template-columns: 1fr;
                gap: 2rem;
                max-width: 1200px;
                margin: 0 auto;
                padding: 1rem;
            }

            @media (min-width: 768px) {
                .alarma-container {
                    grid-template-columns: 1fr 1fr;
                }
            }

            .alarma-form {
                background: var(--surface-color);
                padding: 2rem;
                border-radius: 15px;
                box-shadow: 0 4px 6px var(--shadow-color);
                transition: transform 0.3s ease;
            }

            .alarma-form:hover {
                transform: translateY(-5px);
            }

            .form-group {
                margin-bottom: 1.5rem;
            }

            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                color: var(--text-color);
                font-weight: 500;
                font-size: 1.1rem;
            }

            .tiempo-alarma {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .tiempo-input {
                width: 100%;
                padding: 0.75rem;
                border: 2px solid var(--border-color);
                border-radius: 8px;
                background: var(--background-color);
                color: var(--text-color);
                font-size: 1rem;
                transition: all 0.3s ease;
            }

            .tiempo-input:focus {
                border-color: var(--primary-color);
                outline: none;
                box-shadow: 0 0 0 3px var(--primary-color-light);
            }

            .tiempo-separador {
                font-size: 1.5rem;
                color: var(--text-color);
                font-weight: bold;
            }

            .dias-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 0.5rem;
                margin-top: 0.5rem;
            }

            .dias-semana {
                background: var(--surface-color);
                padding: 1rem;
                border-radius: 8px;
                margin: 1rem 0;
                border: 1px solid var(--border-color);
            }

            .dia-checkbox {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.75rem;
                background: var(--background-color);
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 1px solid var(--border-color);
            }

            .dia-checkbox:hover {
                background: var(--primary-color);
                color: white;
                transform: translateY(-2px);
            }

            .dia-checkbox input[type="checkbox"] {
                width: 18px;
                height: 18px;
                cursor: pointer;
            }

            .video-selector {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .video-preview {
                width: 100%;
                max-width: 400px;
                margin: 0 auto;
                background: var(--background-color);
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 4px var(--shadow-color);
            }

            .video-preview video {
                width: 100%;
                height: auto;
                display: block;
            }

            .btn-primary {
                width: 100%;
                padding: 1rem;
                background: var(--primary-color);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1.1rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }

            .btn-primary:hover {
                background: var(--primary-color-dark);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px var(--shadow-color);
            }

            .alarmas-activas {
                background: var(--surface-color);
                padding: 2rem;
                border-radius: 15px;
                box-shadow: 0 4px 6px var(--shadow-color);
                transition: transform 0.3s ease;
            }

            .alarmas-activas:hover {
                transform: translateY(-5px);
            }

            .alarmas-activas h2 {
                color: var(--primary-color);
                margin-bottom: 1.5rem;
                text-align: center;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                font-size: 1.5rem;
            }

            #listaAlarmas {
                max-height: 500px;
                overflow-y: auto;
                padding: 1rem;
            }

            .alarma-item {
                background: var(--surface-color);
                border-radius: 8px;
                padding: 1.5rem;
                margin-bottom: 1rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: all 0.3s ease;
                border: 1px solid var(--border-color);
                box-shadow: 0 2px 4px var(--shadow-color);
            }

            .alarma-item:hover {
                transform: translateX(5px);
                box-shadow: 0 4px 8px var(--shadow-color);
                border-color: var(--primary-color);
            }

            .alarma-info {
                flex: 1;
            }

            .alarma-tiempo {
                font-size: 1.4rem;
                color: var(--primary-color);
                margin-bottom: 0.5rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-weight: bold;
            }

            .alarma-detalle {
                font-size: 1rem;
                color: var(--text-color);
                line-height: 1.4;
            }

            .btn-eliminar {
                background: var(--error-color);
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 1rem;
            }

            .btn-eliminar:hover {
                background: var(--error-color-hover);
                transform: scale(1.05);
            }

            .video-container {
                max-width: 800px;
                margin: 2rem auto;
                padding: 1rem;
                background: var(--surface-color);
                border-radius: 15px;
                box-shadow: 0 4px 6px var(--shadow-color);
            }

            .video-container video {
                width: 100%;
                border-radius: 8px;
                margin-bottom: 1rem;
            }

            .btn-detener {
                width: 100%;
                padding: 1rem;
                background: var(--error-color);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1.1rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }

            .btn-detener:hover {
                background: var(--error-color-hover);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px var(--shadow-color);
            }

            /* Estilos para el scrollbar */
            #listaAlarmas::-webkit-scrollbar {
                width: 8px;
            }

            #listaAlarmas::-webkit-scrollbar-track {
                background: var(--background-color);
                border-radius: 4px;
            }

            #listaAlarmas::-webkit-scrollbar-thumb {
                background: var(--primary-color);
                border-radius: 4px;
            }

            #listaAlarmas::-webkit-scrollbar-thumb:hover {
                background: var(--primary-color-dark);
            }

            .opciones-extra {
                background: var(--surface-color);
                padding: 1rem;
                border-radius: 8px;
                margin: 1rem 0;
                border: 1px solid var(--border-color);
            }

            .integraciones {
                display: flex;
                gap: 1rem;
                flex-wrap: wrap;
                margin-top: 0.5rem;
            }

            .btn-integracion {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 6px;
                background: var(--primary-color);
                color: white;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn-integracion:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            .opciones-adicionales {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                margin-top: 0.5rem;
            }

            .opcion-checkbox {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.75rem;
                background: var(--background-color);
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 1px solid var(--border-color);
            }

            .opcion-checkbox:hover {
                background: var(--primary-color);
                color: white;
            }

            .opcion-checkbox input[type="checkbox"] {
                width: 18px;
                height: 18px;
                cursor: pointer;
            }

            @media (max-width: 768px) {
                .integraciones {
                    flex-direction: column;
                }
                
                .btn-integracion {
                    width: 100%;
                    justify-content: center;
                }
            }

            .opciones-bienestar {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                margin-top: 0.5rem;
            }

            .config-bienestar {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
            }

            .config-item {
                background: var(--background-color);
                padding: 1rem;
                border-radius: 8px;
                border: 1px solid var(--border-color);
            }

            .config-item label {
                display: block;
                margin-bottom: 0.5rem;
                color: var(--text-color);
                font-weight: 500;
            }

            .config-item select {
                width: 100%;
                padding: 0.5rem;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                background: var(--surface-color);
                color: var(--text-color);
            }

            @media (max-width: 768px) {
                .config-bienestar {
                    gap: 0.75rem;
                }
                
                .config-item {
                    padding: 0.75rem;
                }
            }

            .config-sueno {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
                margin-top: 1rem;
            }

            .calidad-sueno {
                display: flex;
                gap: 0.5rem;
                flex-wrap: wrap;
                margin-top: 0.5rem;
            }

            .btn-calidad {
                padding: 0.5rem 1rem;
                border: 1px solid var(--border-color);
                border-radius: 20px;
                background: var(--background-color);
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn-calidad:hover, .btn-calidad.active {
                background: var(--primary-color);
                color: white;
                transform: translateY(-2px);
            }

            .resumen-sueno {
                margin-top: 2rem;
                padding: 1.5rem;
                background: var(--surface-color);
                border-radius: 12px;
                border: 1px solid var(--border-color);
            }

            .resumen-sueno h3 {
                color: var(--primary-color);
                margin-bottom: 1rem;
                text-align: center;
            }

            .resumen-content {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .resumen-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 0.75rem;
                background: var(--background-color);
                border-radius: 8px;
            }

            .resumen-item i {
                font-size: 1.2rem;
                color: var(--primary-color);
            }

            .resumen-item strong {
                margin-left: auto;
                color: var(--primary-color);
            }

            @media (max-width: 768px) {
                .calidad-sueno {
                    flex-direction: column;
                }
                
                .btn-calidad {
                    width: 100%;
                }
            }
        `;

        // Agregar los nuevos estilos al documento
        const styleElement = document.createElement('style');
        styleElement.textContent = style.textContent;
        document.head.appendChild(styleElement);
    </script>
</body>
</html>
